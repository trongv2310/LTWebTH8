@model List<LTWeb09_Bai03_Buoi08.Models.Employee>
@{
    ViewBag.Title = "Lọc theo phòng ban";
    Layout = "~/Views/Shared/_Layout.cshtml";
    var departments = ViewBag.Departments as List<LTWeb09_Bai03_Buoi08.Models.Department> ?? new List<LTWeb09_Bai03_Buoi08.Models.Department>();
    int? selectedDeptId = ViewBag.SelectedDeptId == null ? null : (int?)ViewBag.SelectedDeptId;
    string selectedDeptName = ViewBag.SelectedDeptName ?? "Tất cả nhân viên";
}

<div class="row">
    <div class="col-md-3 mb-4">
        <h5>Phòng ban</h5>
        <div class="list-group">
            @Html.ActionLink("Tất cả nhân viên", "BrowseByDepartment", "Home", new { deptId = (int?)null }, new { @class = (selectedDeptId == null ? "list-group-item list-group-item-action active" : "list-group-item list-group-item-action") })
            @foreach (var d in departments)
            {
                var cls = (selectedDeptId != null && d.DeptId == selectedDeptId) ? "list-group-item list-group-item-action active" : "list-group-item list-group-item-action";
                @Html.ActionLink(d.Name, "BrowseByDepartment", "Home", new { deptId = d.DeptId }, new { @class = cls })
            }
        </div>
        <div class="mt-3">
            @Html.ActionLink("Trở về trang Index", "Index", "Home", null, new { @class = "btn btn-primary w-100" })
        </div>
    </div>

    <div class="col-md-9">
        <h4 class="mb-3">@selectedDeptName</h4>

        @if (Model == null || !Model.Any())
        {
            <div class="alert alert-info">Không có nhân viên.</div>
        }
        else
        {
            <table class="table table-bordered table-striped align-middle">
                <thead class="table-light">
                    <tr>
                        <th style="width:80px">Mã NV</th>
                        <th>Họ và Tên</th>
                        <th style="width:80px">Ảnh</th>
                        <th>Phòng ban</th>
                        <th style="width:180px"></th>
                    </tr>
                </thead>
                <tbody>
                    @foreach (var item in Model)
                    {
                        <tr>
                            <td>@item.Id</td>
                            <td>@item.Name</td>
                            <td>
                                @{
                                    var img = item.Img;
                                    if (string.IsNullOrWhiteSpace(img))
                                    {
                                        img = "~/Content/Images/nham.png";
                                    }
                                    else if (!img.StartsWith("~") && !img.StartsWith("/"))
                                    {
                                        img = "~/" + img.TrimStart('/');
                                    }
                                    var imgUrl = Url.Content(img);
                                }
                                <img src="@imgUrl" alt="avatar" style="width:50px;height:50px;object-fit:cover;border-radius:6px" />
                            </td>
                            <td>@(item.Department?.Name ?? "-")</td>
                            <td>
                                @Html.ActionLink("Edit", "Edit", "Home", new { id = item.Id }, new { @class = "btn btn-sm btn-outline-primary me-1" })
                                @Html.ActionLink("Details", "Details", "Home", new { id = item.Id }, new { @class = "btn btn-sm btn-outline-secondary me-1" })
                                @Html.ActionLink("Delete", "Delete", "Home", new { id = item.Id }, new { @class = "btn btn-sm btn-outline-danger" })
                            </td>
                        </tr>
                    }
                </tbody>
            </table>
        }
    </div>
</div>
